<?xml version="1.0" encoding="UTF-8"?>
<!-- ====================================================================== 
     Ant script for automated release and deploy of update site.
     Sample usage:
     ant -f repo-release-script.xml uploadPreReleaseRepo -DcommitLog="new daily"
     ====================================================================== -->
<project name="project" >

	<property name="repoSrc" location="bin-maven/ddt.feature-repository/repository" ></property>

	<property name="gitLocation">git</property>
	
	
	<target name="echoInfo">
		<echo>${commitLog}</echo>
		<echo>${repoSrc}</echo>
		<echo>${repoDest}</echo>
	</target>
	
	<target name="setPreReleaseSite" depends="">
		<property name="repoDest" location="../ddt.updates-PR" />
	</target>
	
	<target name="setReleaseSite" depends="">
		<property name="repoDest" location="../ddt.updates" />
	</target>


	<target name="uploadPreReleaseRepo" depends="setPreReleaseSite, uploadRepo"/>
	<target name="uploadReleaseRepo" depends="setReleaseSite, uploadRepo" />
	
	
	<target name="uploadRepo" depends="echoInfo">
		<fail message="Files are missing.">
		    <condition>
		        <not>
		        	<available file="${repoDest}" type="dir" />
		        </not>
		    </condition>
		</fail>
		<fail unless="commitLog"/>

		<delete verbose="true">
			<fileset dir="${repoDest}" includes="**/*.jar"/>
		</delete>
		<copy verbose="true" todir="${repoDest}">
			<fileset dir="${repoSrc}"/>
		</copy>
		
		<exec dir="${repoDest}" executable="${gitLocation}" >
		  	<arg line="status"/>
		</exec>
		<exec dir="${repoDest}" executable="${gitLocation}" >
		  	<arg line="add -A *"/>
		</exec>
		<exec dir="${repoDest}" executable="${gitLocation}" >
			<arg line="commit -m"/>
			<arg value="${commitLog}"/>
		</exec>
		<exec dir="${repoDest}" executable="${gitLocation}" >
			<arg line="push origin"/>
		</exec>
	</target>

</project>
